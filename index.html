<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Pulse</title>
    <!-- Tailwind CSS CDN for utility-first styling -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts CDN for 'Press Start 2P' (pixelated font) and 'Inter' (default) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        /* Custom CSS for non-neon space theme */
        :root {
            --space-blue: #008c9e; /* A more subdued blue */
            --accent-color: #8c009e; /* A complementary accent */
            --dark-bg: #0a0a0a;
            --panel-bg: #1a1a1a;
            --text-color: #e0e0e0;
        }

        body {
            font-family: 'Inter', sans-serif; /* Default font */
            background-color: var(--dark-bg);
            color: var(--text-color);
            overflow: hidden; /* Prevent scrollbars due to canvas */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Full viewport height */
            margin: 0;
            position: relative; /* For canvas positioning */
        }

        /* Canvas for background */
        #backgroundCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Behind other content */
        }

        /* Main app container to hold content above canvas */
        #app-container {
            position: relative;
            z-index: 1; /* Above canvas */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            max-width: 1200px; /* Max width for desktop */
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
        }

        /* Pixelated Font for specific elements */
        .font-pixel {
            font-family: 'Press Start 2P', cursive;
        }

        /* Subtle text styling (no neon glow) */
        .subtle-text-effect {
            /* Removed text-shadow for neon */
            color: var(--text-color); /* Ensure good contrast */
        }

        /* Subtle border styling (no neon glow) */
        .subtle-border {
            border: 2px solid var(--space-blue);
            box-shadow: 0 0 5px rgba(0, 140, 158, 0.3); /* Softer shadow */
        }

        /* Panel effect for data cards (subtle glow) */
        .glowing-panel {
            background-color: var(--panel-bg);
            border: 1px solid rgba(0, 140, 158, 0.3); /* Lighter border for panel */
            box-shadow: 0 0 8px rgba(0, 140, 158, 0.4), inset 0 0 4px rgba(0, 140, 158, 0.15); /* Softer glow */
            transition: all 0.3s ease-in-out;
        }

        .glowing-panel:hover {
            box-shadow: 0 0 12px var(--space-blue), inset 0 0 6px rgba(0, 140, 158, 0.3); /* Slightly more pronounced on hover */
            transform: translateY(-2px);
        }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            #app-container {
                padding: 2rem;
            }
        }

        /* Loading spinner CSS */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid var(--space-blue); /* Blue */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto; /* Center the loader */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <!-- Canvas for the animated background -->
    <canvas id="backgroundCanvas"></canvas>

    <!-- Main application container -->
    <div id="app-container" class="relative z-10 flex flex-col items-center p-4 md:p-8 w-full max-w-6xl mx-auto">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="font-pixel text-4xl md:text-6xl text-white subtle-text-effect mb-2">Planet Pulse</h1>
            <p class="font-inter text-xl md:text-2xl text-gray-300 subtle-text-effect">Your Window to the Cosmos.</p>
        </header>

        <!-- Main Data Cards Container -->
        <main id="data-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
            <!-- Global Surface Temperature Card -->
            <div id="temp-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Global Temperature</h2>
                <p class="text-5xl font-bold text-white mb-2" id="global-temp-value">--.-</p>
                <span class="text-lg text-gray-400" id="global-temp-unit">°C</span>
                <div class="loader hidden mt-4" id="global-temp-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="global-temp-status">Fetching data...</div>
            </div>

            <!-- Atmospheric CO₂ Levels Card -->
            <div id="co2-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Atmospheric CO₂</h2>
                <p class="text-5xl font-bold text-white mb-2" id="co2-value">----</p>
                <span class="text-lg text-gray-400" id="co2-unit">ppm</span>
                <div class="loader hidden mt-4" id="co2-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="co2-status">Fetching data...</div>
            </div>

            <!-- Solar Activity (Sunspots) Card -->
            <div id="solar-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Solar Activity</h2>
                <p class="text-5xl font-bold text-white mb-2" id="solar-value">---</p>
                <span class="text-lg text-gray-400" id="solar-unit">X-ray Flux</span>
                <div class="loader hidden mt-4" id="solar-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="solar-status">Fetching data...</div>
            </div>

            <!-- Active Satellites in Orbit Card -->
            <div id="satellites-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Active Satellites</h2>
                <p class="text-5xl font-bold text-white mb-2" id="satellites-value">-----</p>
                <span class="text-lg text-gray-400" id="satellites-unit">in Orbit</span>
                <div class="loader hidden mt-4" id="satellites-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="satellites-status">Fetching data...</div>
            </div>

            <!-- Radiation Index / Solar Storms Card -->
            <div id="radiation-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Radiation Index</h2>
                <p class="text-5xl font-bold text-white mb-2" id="radiation-value">--</p>
                <span class="text-lg text-gray-400" id="radiation-unit">Proton Flux</span>
                <div class="loader hidden mt-4" id="radiation-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="radiation-status">Fetching data...</div>
            </div>

            <!-- Ozone Layer Status (or Space Facts) Card -->
            <div id="ozone-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Space Fact</h2>
                <p class="text-xl font-bold text-white mb-2" id="ozone-value">Loading facts...</p>
                <div class="loader hidden mt-4" id="ozone-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="ozone-status"></div>
            </div>

        </main>

        <!-- Footer Section -->
        <footer class="mt-12 text-center text-gray-400 font-pixel text-sm subtle-text-effect">
            Made for Earthlings, By Yuvika V
        </footer>
    </div>

    <script>
        // Get the canvas element and its 2D rendering context
        const canvas = document.getElementById('backgroundCanvas');
        const ctx = canvas.getContext('2d');

        // Array to hold our "stars"
        const stars = [];
        const numStars = 200; // Number of stars to render

        // Function to set canvas dimensions to fill the window
        function setCanvasSize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            // When resizing, re-initialize stars to ensure they fill the new dimensions
            stars.length = 0; // Clear existing stars
            initStars(); // Re-create stars for the new size
        }

        // Star object constructor
        function Star() {
            this.x = Math.random() * canvas.width; // Random x position
            // Start stars at random Y positions across the screen for a more natural initial look
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2 + 0.5; // Random size between 0.5 and 2.5
            this.speed = Math.random() * 0.5 + 0.1; // Random speed
            // Random grayscale color for a subtle effect
            const gray = Math.floor(Math.random() * 150) + 100; // Grayscale from 100 to 250
            this.color = `rgb(${gray}, ${gray}, ${gray})`;
        }

        // Initialize stars
        function initStars() {
            for (let i = 0; i < numStars; i++) {
                stars.push(new Star());
            }
        }

        // Function to draw a star
        function drawStar(star) {
            ctx.fillStyle = star.color;
            ctx.fillRect(star.x, star.y, star.size, star.size); // Draw a square for a pixelated look
        }

        // Function to update star positions
        function updateStars() {
            for (let i = 0; i < numStars; i++) {
                const star = stars[i];
                star.y += star.speed; // Move star downwards

                // If star goes off-screen, reset it to the top
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width; // New random x position
                    star.size = Math.random() * 2 + 0.5; // New random size
                    star.speed = Math.random() * 0.5 + 0.1; // New random speed
                }
            }
        }

        // Animation loop
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the entire canvas
            updateStars(); // Update star positions
            stars.forEach(drawStar); // Draw all stars
            requestAnimationFrame(animate); // Request next frame
        }

        // --- API Fetching Functions ---

        // Helper function to show/hide loader and update status
        function updateCardStatus(cardId, showLoader, statusText, valueText = null, unitText = null) {
            const loader = document.getElementById(`${cardId}-loader`);
            const status = document.getElementById(`${cardId}-status`);
            const value = document.getElementById(`${cardId}-value`);
            const unit = document.getElementById(`${cardId}-unit`);

            if (showLoader) {
                loader.classList.remove('hidden');
                status.textContent = statusText;
                if (value) value.textContent = '--.-'; // Reset value while loading
                if (unit) unit.textContent = ''; // Clear unit while loading
            } else {
                loader.classList.add('hidden');
                status.textContent = statusText;
                if (valueText !== null) value.textContent = valueText;
                if (unitText !== null) unit.textContent = unitText;
            }
        }

        // Function to fetch Global Surface Temperature
        async function fetchGlobalTemperature() {
            const cardId = 'global-temp';
            updateCardStatus(cardId, true, 'Fetching current temperature...');

            try {
                // Using Open-Meteo for current weather at the equator as a global proxy
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=0&longitude=0&current_weather=true&temperature_unit=celsius&forecast_days=1');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                const temperature = data.current_weather.temperature;
                const time = new Date(data.current_weather.time).toLocaleTimeString();

                updateCardStatus(
                    cardId,
                    false,
                    `Last updated: ${time} (Open-Meteo)`,
                    temperature.toFixed(1), // Format to one decimal place
                    '°C'
                );
            } catch (error) {
                console.error('Error fetching global temperature:', error);
                updateCardStatus(cardId, false, 'Failed to load data.', 'N/A', '');
            }
        }

        // Function to fetch Atmospheric CO₂ Levels
        async function fetchCO2Levels() {
            const cardId = 'co2';
            updateCardStatus(cardId, true, 'Fetching CO₂ data...');

            try {
                // Using global-warming.org API for CO2 data
                const response = await fetch('https://global-warming.org/api/co2-api');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // The API returns an array, take the last (most recent) entry
                const latestCO2 = data.co2[data.co2.length - 1];
                const value = parseFloat(latestCO2.cycle); // Cycle value is usually the CO2 in ppm
                const year = latestCO2.year;

                updateCardStatus(
                    cardId,
                    false,
                    `Latest: ${year} (global-warming.org)`,
                    value.toFixed(2), // Format to two decimal places
                    'ppm'
                );
            } catch (error) {
                console.error('Error fetching CO2 levels:', error);
                updateCardStatus(cardId, false, 'Failed to load data.', 'N/A', '');
            }
        }

        // Function to fetch Solar Activity (X-ray Flux)
        async function fetchSolarActivity() {
            const cardId = 'solar';
            updateCardStatus(cardId, true, 'Fetching solar activity...');

            try {
                // Using NOAA SWPC for GOES X-ray flux data
                const response = await fetch('https://services.swpc.noaa.gov/json/goes/primary/xrays-6-hour.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Get the latest data point
                const latestFlux = data[data.length - 1];
                const fluxValue = latestFlux.flux;
                const time = new Date(latestFlux.time_tag).toLocaleTimeString();

                updateCardStatus(
                    cardId,
                    false,
                    `Last updated: ${time} (NOAA SWPC)`,
                    fluxValue.toExponential(1), // Display in scientific notation
                    'W/m²'
                );
            } catch (error) {
                console.error('Error fetching solar activity:', error);
                updateCardStatus(cardId, false, 'Failed to load data.', 'N/A', '');
            }
        }

        // Function to display a static satellite fact
        function displaySatelliteFact() {
            const cardId = 'satellites';
            const fact = "Over 10,000 active satellites orbit Earth, providing GPS, communication, and scientific data!";
            updateCardStatus(
                cardId,
                false,
                'Source: Various Estimates',
                '~10,000+',
                'in Orbit'
            );
            // Update the main value to be the fact itself for a better display
            document.getElementById(`${cardId}-value`).textContent = fact;
            document.getElementById(`${cardId}-value`).classList.remove('text-5xl'); // Adjust font size for fact
            document.getElementById(`${cardId}-value`).classList.add('text-lg');
            document.getElementById(`${cardId}-unit`).textContent = ''; // Clear unit for fact
        }


        // Function to fetch Radiation Index (Proton Flux)
        async function fetchRadiationIndex() {
            const cardId = 'radiation';
            updateCardStatus(cardId, true, 'Fetching radiation data...');

            try {
                // Using NOAA SWPC for GOES Proton Flux data
                const response = await fetch('https://services.swpc.noaa.gov/json/goes/primary/proton-flux-1-day.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Get the latest data point
                const latestProtonFlux = data[data.length - 1];
                const fluxValue = latestProtonFlux.flux;
                const energy = latestProtonFlux.energy; // e.g., >10 MeV
                const time = new Date(latestProtonFlux.time_tag).toLocaleTimeString();

                updateCardStatus(
                    cardId,
                    false,
                    `Last updated: ${time} (NOAA SWPC)`,
                    fluxValue.toExponential(1), // Display in scientific notation
                    `${energy}` // Use the energy level as the unit/context
                );
            } catch (error) {
                console.error('Error fetching radiation index:', error);
                updateCardStatus(cardId, false, 'Failed to load data.', 'N/A', '');
            }
        }

        // Array of space facts for the rotating display
        const spaceFacts = [
            "A day on Venus is longer than its year.",
            "There are more stars in the universe than grains of sand on all Earth's beaches.",
            "The Sun's mass is 99.8% of the entire solar system's mass.",
            "One million Earths could fit inside the Sun.",
            "Neutron stars can spin 600 times per second.",
            "The largest known asteroid is Ceres, about 940 km wide.",
            "The highest mountain discovered is on Mars: Olympus Mons.",
            "Footprints on the Moon will stay there for 100 million years.",
            "The universe is estimated to be 13.8 billion years old.",
            "Jupiter's Great Red Spot is a storm larger than Earth.",
            "It takes 8 minutes for light from the Sun to reach Earth.",
            "The coldest place in the universe is the Boomerang Nebula.",
            "There are more trees on Earth than stars in the Milky Way.",
            "The Milky Way galaxy is about 100,000 light-years across."
        ];
        let currentFactIndex = 0;

        // Function to rotate space facts
        function rotateSpaceFacts() {
            const cardId = 'ozone';
            const ozoneValueElement = document.getElementById(`${cardId}-value`);
            const ozoneStatusElement = document.getElementById(`${cardId}-status`);

            // Ensure the value element is correctly sized for text
            ozoneValueElement.classList.remove('text-5xl');
            ozoneValueElement.classList.add('text-xl'); // Adjust font size for fact

            ozoneValueElement.textContent = spaceFacts[currentFactIndex];
            ozoneStatusElement.textContent = `Fact ${currentFactIndex + 1} of ${spaceFacts.length}`;

            currentFactIndex = (currentFactIndex + 1) % spaceFacts.length; // Cycle through facts
        }

        // Function to refresh all API data
        async function refreshAllData() {
            console.log('Refreshing all data...');
            await fetchGlobalTemperature();
            await fetchCO2Levels();
            await fetchSolarActivity();
            displaySatelliteFact(); // This is static, but included for completeness
            await fetchRadiationIndex();
            // rotateSpaceFacts is on its own interval, so no need to call it here
        }

        // Event listeners
        window.addEventListener('resize', setCanvasSize);

        // Initialize and start animation and data fetching when the window loads
        window.onload = function() {
            setCanvasSize(); // Set initial size and initialize stars
            animate(); // Start the animation loop

            // Fetch initial data for all cards
            refreshAllData();

            // Set interval to refresh data every 5 minutes (300,000 milliseconds)
            setInterval(refreshAllData, 300000);

            // Start rotating space facts (already on its own interval)
            rotateSpaceFacts(); // Display first fact immediately
            setInterval(rotateSpaceFacts, 10000); // Rotate facts every 10 seconds
        };
    </script>
</body>
</html>
