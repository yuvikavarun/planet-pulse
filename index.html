<!DOCTYPE html
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planet Pulse</title>
    <!-- Favicon: A planet icon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>&#127757;</text></svg>">
    <!-- Tailwind CSS CDN for utility-first styling -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts CDN for 'Press Start 2P' (pixelated font) and 'Inter' (default) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- Chart.js CDN for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
        /* CSS for the space theme */
        :root {
            --space-blue: #008c9e;
            --accent-color: #8c009e;
            --dark-bg: #0a0a0a;
            --panel-bg: #1a1a1a;
            --text-color: #e0e0e0;
        }

        body {
            font-family: 'Inter', sans-serif; 
            background-color: var(--dark-bg);
            color: var(--text-color);
            /* Removed overflow: hidden; to allow scrolling if content exceeds viewport */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh; /* Full viewport height */
            margin: 0;
            position: relative; /* For canvas positioning */
        }

        /* Canvas for background */
        #backgroundCanvas {
            position: fixed; /* Changed to fixed to stay in background during scroll */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0; /* Behind other content */
        }

        /* Main app container to hold content above canvas */
        #app-container {
            position: relative;
            z-index: 1; /* Above canvas */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            max-width: 1200px; /* Max width for desktop */
            width: 100%;
            box-sizing: border-box; /* Include padding in width */
            opacity: 0; /* Initially hidden, will fade in after loading */
            transition: opacity 1s ease-in-out;
            min-height: 100vh; /* Ensure container is at least full height */
        }

        /* Pixelated Font for specific elements */
        .font-pixel {
            font-family: 'Press Start 2P', cursive;
        }

        /* Subtle text styling (no neon glow) */
        .subtle-text-effect {
            /* Removed text-shadow for neon */
            color: var(--text-color); /* Ensure good contrast */
        }

        /* Subtle border styling (no neon glow) */
        .subtle-border {
            border: 2px solid var(--space-blue);
            box-shadow: 0 0 5px rgba(0, 140, 158, 0.3); /* Softer shadow */
        }

        /* Panel effect for data cards (subtle glow) */
        .glowing-panel {
            background-color: var(--panel-bg);
            border: 1px solid rgba(0, 140, 158, 0.3); /* Lighter border for panel */
            box-shadow: 0 0 8px rgba(0, 140, 158, 0.4), inset 0 0 4px rgba(0, 140, 158, 0.15); /* Softer glow */
            transition: all 0.3s ease-in-out;
        }

        .glowing-panel:hover {
            box-shadow: 0 0 12px var(--space-blue), inset 0 0 6px rgba(0, 140, 158, 0.3); /* Slightly more pronounced on hover */
            transform: translateY(-2px);
        }

        /* Responsive adjustments */
        @media (min-width: 768px) {
            #app-container {
                padding: 2rem;
            }
        }

        /* Loading spinner CSS */
        .loader {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid var(--space-blue); /* Blue */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 0 auto; /* Center the loader */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Button specific styles */
        .refresh-button {
            background-color: var(--space-blue);
            color: var(--text-color);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            border: none;
            box-shadow: 0 0 8px rgba(0, 140, 158, 0.4);
        }

        .refresh-button:hover:not(:disabled) {
            background-color: #00aacc; /* Slightly lighter blue on hover */
            box-shadow: 0 0 12px var(--space-blue);
        }

        .refresh-button:disabled {
            background-color: #4a4a4a;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* Chart specific styles */
        .chart-container {
            position: relative;
            height: 150px; /* Fixed height for charts */
            width: 100%;
            margin-top: 1rem;
            /* Initial hidden state with transition */
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
        }

        .chart-container.chart-visible {
            max-height: 150px; /* Expand to show chart */
            opacity: 1;
        }

        /* Loading Overlay Styles */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark-bg); /* Match body background */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999; /* Ensure it's on top */
            color: var(--text-color);
            font-family: 'Press Start 2P', cursive;
            font-size: 1.5rem;
            transition: opacity 1s ease-in-out;
        }

        #loading-overlay.hidden {
            opacity: 0;
            pointer-events: none; /* Allow clicks through once hidden */
        }

        #loading-overlay p {
            margin-top: 1rem;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
        }

        /* Navigation buttons for Space Fact card */
        .fact-nav-button {
            background-color: rgba(0, 140, 158, 0.6); /* Semi-transparent space-blue */
            color: var(--text-color);
            padding: 0.25rem 0.75rem;
            border-radius: 0.25rem;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.8rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
            border: none;
        }

        .fact-nav-button:hover {
            background-color: var(--space-blue);
        }

        .fact-nav-button:disabled {
            background-color: #4a4a4a;
            cursor: not-allowed;
            opacity: 0.5;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="flex flex-col items-center justify-center">
        <div class="loader w-16 h-16"></div> <!-- Larger loader for overlay -->
        <h2 class="font-pixel text-2xl mt-4">Initiating Planet Pulse...</h2>
        <p>Loading vital Earth data.</p>
    </div>

    <!-- Canvas for the animated background -->
    <canvas id="backgroundCanvas"></canvas>

    <!-- Main application container -->
    <div id="app-container" class="relative z-10 flex flex-col items-center p-4 md:p-8 w-full max-w-6xl mx-auto">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="font-pixel text-4xl md:text-6xl text-white subtle-text-effect mb-2">Planet Pulse</h1>
            <p class="font-inter text-xl md:text-2xl text-gray-300 subtle-text-effect">Your Window to the Cosmos.</p>
            <!-- Manual Refresh Button -->
            <button id="refreshButton" class="refresh-button mt-6">Refresh All Data</button>
        </header>

        <!-- Main Data Cards Container -->
        <main id="data-cards-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 w-full">
            <!-- Global Surface Temperature Card -->
            <div id="temp-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Global Temperature</h2>
                <p class="text-5xl font-bold text-white mb-2" id="global-temp-value">--.-</p>
                <span class="text-lg text-gray-400" id="global-temp-unit">°C</span>
                <div class="loader hidden mt-4" id="global-temp-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="global-temp-status">Fetching data...</div>
                <div class="chart-container">
                    <canvas id="temperatureChart"></canvas>
                </div>
            </div>

            <!-- Atmospheric CO₂ Levels Card -->
            <div id="co2-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6-6m-6 6l6 6m-6-6h6" />
                </svg>
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Atmospheric CO₂</h2>
                <p class="text-5xl font-bold text-white mb-2" id="co2-value">----</p>
                <span class="text-lg text-gray-400" id="co2-unit">ppm</span>
                <div class="loader hidden mt-4" id="co2-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="co2-status">Fetching data...</div>
                <div class="chart-container">
                    <canvas id="co2Chart"></canvas>
                </div>
            </div>

            <!-- Solar Activity (Sunspots) Card -->
            <div id="solar-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.325 6.675l-.707-.707M6.675 6.675l-.707-.707m10.65 0l-.707.707M6.675 17.325l-.707.707M12 7a5 5 0 100 10 5 5 0 000-10z" />
                </svg>
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Solar Activity</h2>
                <p class="text-5xl font-bold text-white mb-2" id="solar-value">---</p>
                <span class="text-lg text-gray-400" id="solar-unit">X-ray Flux</span>
                <div class="loader hidden mt-4" id="solar-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="solar-status">Fetching data...</div>
            </div>

            <!-- Active Satellites in Orbit Card -->
            <div id="satellites-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 8a8 8 0 01-8-8H4a10 10 0 0010 10V2a1 1 0 011-1h.5a1 1 0 011 1v.5a1 1 0 01-1 1h-.5a1 1 0 01-1-1v-.5a1 1 0 011-1z" />
                </svg>
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Active Satellites</h2>
                <p class="text-5xl font-bold text-white mb-2" id="satellites-value">-----</p>
                <span class="text-lg text-gray-400" id="satellites-unit">in Orbit</span>
                <div class="loader hidden mt-4" id="satellites-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="satellites-status">Fetching data...</div>
            </div>

            <!-- Global UV Index Card (Replaces ISS Live Location) -->
            <div id="uv-index-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.325 6.675l-.707-.707M6.675 6.675l-.707-.707m10.65 0l-.707.707M6.675 17.325l-.707.707M12 7a5 5 0 100 10 5 5 0 000-10z" />
                </svg>
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Global UV Index</h2>
                <p class="text-5xl font-bold text-white mb-2" id="uv-index-value">--</p>
                <span class="text-lg text-gray-400" id="uv-index-unit"></span>
                <div class="loader hidden mt-4" id="uv-index-loader"></div>
                <div class="text-sm text-gray-500 mt-2" id="uv-index-status">Fetching data...</div>
            </div>

            <!-- Ozone Layer Status (or Space Facts) Card -->
            <div id="ozone-card" class="glowing-panel rounded-lg p-6 flex flex-col items-center text-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l-7 7-7-7m7 7v10a1 1 0 01-1 1h-3" />
                </svg>
                <h2 class="font-pixel text-xl mb-3 subtle-text-effect">Space Fact</h2>
                <p class="text-xl font-bold text-white mb-2" id="ozone-value">Loading facts...</p>
                <div class="flex justify-center items-center mt-4 space-x-4">
                    <button id="prevFactBtn" class="fact-nav-button">&lt;</button>
                    <div class="loader hidden" id="ozone-loader"></div>
                    <button id="nextFactBtn" class="fact-nav-button">&gt;</button>
                </div>
                <div class="text-sm text-gray-500 mt-2" id="ozone-status"></div>
            </div>

        </main>

        <!-- Footer Section -->
        <footer class="mt-12 text-center text-gray-400 font-pixel text-sm subtle-text-effect">
            Made for Earthlings, By Yuvika V
        </footer>
    </div>

    <script>
        // Get the canvas element and its 2D rendering context
        const canvas = document.getElementById('backgroundCanvas');
        const ctx = canvas.getContext('2d');

        // Array to hold our "stars"
        const stars = [];
        const numStars = 200; // Number of stars to render

        // Function to set canvas dimensions to fill the window
        function setCanvasSize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            // When resizing, re-initialize stars to ensure they fill the new dimensions
            stars.length = 0; // Clear existing stars
            initStars(); // Re-create stars for the new size
        }

        // Star object constructor
        function Star() {
            this.x = Math.random() * canvas.width; // Random x position
            // Start stars at random Y positions across the screen for a more natural initial look
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2 + 0.5; // Random size between 0.5 and 2.5
            this.speed = Math.random() * 0.5 + 0.1; // Random speed
            // Random grayscale color for a subtle effect
            const gray = Math.floor(Math.random() * 150) + 100; // Grayscale from 100 to 250
            this.color = `rgb(${gray}, ${gray}, ${gray})`;
        }

        // Initialize stars
        function initStars() {
            for (let i = 0; i < numStars; i++) {
                stars.push(new Star());
            }
        }

        // Function to draw a star
        function drawStar(star) {
            ctx.fillStyle = star.color;
            ctx.fillRect(star.x, star.y, star.size, star.size); // Draw a square for a pixelated look
        }

        // Function to update star positions
        function updateStars() {
            for (let i = 0; i < numStars; i++) {
                const star = stars[i];
                star.y += star.speed; // Move star downwards

                // If star goes off-screen, reset it to the top
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width; // New random x position
                    star.size = Math.random() * 2 + 0.5; // New random size
                    star.speed = Math.random() * 0.5 + 0.1; // New random speed
                }
            }
        }

        // Animation loop
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear the entire canvas
            updateStars(); // Update star positions
            stars.forEach(drawStar); // Draw all stars
            requestAnimationFrame(animate); // Request next frame
        }

        // --- API Fetching Functions ---

        // Helper function to show/hide loader and update status
        function updateCardStatus(cardId, showLoader, statusText, valueText = null, unitText = null) {
            const loader = document.getElementById(`${cardId}-loader`);
            const status = document.getElementById(`${cardId}-status`);
            const value = document.getElementById(`${cardId}-value`);
            const unit = document.getElementById(`${cardId}-unit`);

            if (showLoader) {
                if (loader) loader.classList.remove('hidden'); // Check if loader exists
                status.textContent = statusText;
                if (value) value.textContent = '--.-'; // Reset value while loading
                if (unit) unit.textContent = ''; // Clear unit while loading
            } else {
                if (loader) loader.classList.add('hidden'); // Check if loader exists
                status.textContent = statusText;
                if (valueText !== null) value.textContent = valueText;
                if (unitText !== null) unit.textContent = unitText;
            }
        }

        // Chart instances
        let temperatureChartInstance = null;
        let co2ChartInstance = null;

        // Function to create/update Temperature Chart
        function createTemperatureChart(labels, data) {
            const ctx = document.getElementById('temperatureChart').getContext('2d');

            if (temperatureChartInstance) {
                temperatureChartInstance.destroy(); // Destroy existing chart before creating a new one
            }

            temperatureChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Temperature (°C)',
                        data: data,
                        borderColor: 'rgba(0, 140, 158, 0.8)', // space-blue
                        backgroundColor: 'rgba(0, 140, 158, 0.2)',
                        borderWidth: 2,
                        pointRadius: 3,
                        pointBackgroundColor: 'rgba(0, 140, 158, 1)',
                        tension: 0.3, // Smooth line
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // Hide legend
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}°C`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(224, 224, 224, 0.7)', // text-color with transparency
                                font: {
                                    family: 'Inter'
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(224, 224, 224, 0.1)' // Very subtle grid lines
                            },
                            ticks: {
                                color: 'rgba(224, 224, 224, 0.7)', // text-color with transparency
                                font: {
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                }
            });
        }

        // Function to create/update CO2 Chart
        function createCO2Chart(labels, data) {
            const ctx = document.getElementById('co2Chart').getContext('2d');

            if (co2ChartInstance) {
                co2ChartInstance.destroy(); // Destroy existing chart before creating a new one
            }

            co2ChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'CO₂ (ppm)',
                        data: data,
                        borderColor: 'rgba(255, 0, 255, 0.8)', // A complementary accent color
                        backgroundColor: 'rgba(255, 0, 255, 0.2)',
                        borderWidth: 2,
                        pointRadius: 3,
                        pointBackgroundColor: 'rgba(255, 0, 255, 1)',
                        tension: 0.3, // Smooth line
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false // Hide legend
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(2)} ppm`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: 'rgba(224, 224, 224, 0.7)',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(224, 224, 224, 0.1)'
                            },
                            ticks: {
                                color: 'rgba(224, 224, 224, 0.7)',
                                font: {
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                }
            });
        }


        // Function to fetch Global Surface Temperature
        async function fetchGlobalTemperature() {
            const cardId = 'global-temp';
            updateCardStatus(cardId, true, 'Fetching current temperature...');

            try {
                // Fetching daily average temperature for the last 7 days
                const endDate = new Date().toISOString().split('T')[0];
                const startDate = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]; // 7 days ago

                const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=0&longitude=0&daily=temperature_2m_mean&temperature_unit=celsius&start_date=${startDate}&end_date=${endDate}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                const dailyTemps = data.daily.temperature_2m_mean;
                const dates = data.daily.time;

                const latestTemperature = dailyTemps[dailyTemps.length - 1];
                const latestTime = new Date(dates[dates.length - 1]).toLocaleDateString(); // Use date for historical

                updateCardStatus(
                    cardId,
                    false,
                    `Latest: ${latestTime} (Open-Meteo)`,
                    latestTemperature.toFixed(1),
                    '°C'
                );

                // Update the chart
                createTemperatureChart(dates.map(d => new Date(d).toLocaleDateString(undefined, { month: 'short', day: 'numeric' })), dailyTemps);

            } catch (error) {
                console.error('Error fetching global temperature:', error);
                updateCardStatus(cardId, false, 'Failed to load data.', 'N/A', '');
                if (temperatureChartInstance) temperatureChartInstance.destroy(); // Clear chart on error
            }
        }

        // Function to fetch Atmospheric CO₂ Levels
        async function fetchCO2Levels() {
            const cardId = 'co2';
            updateCardStatus(cardId, true, 'Fetching CO₂ data...');

            try {
                // Using global-warming.org API for CO2 data
                const response = await fetch('https://global-warming.org/api/co2-api');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Get the latest 30 CO2 data points for the chart
                const co2DataPoints = data.co2.slice(Math.max(data.co2.length - 30, 0)); // Last 30 points
                const labels = co2DataPoints.map(entry => entry.year);
                const values = co2DataPoints.map(entry => parseFloat(entry.cycle));

                const latestCO2 = data.co2[data.co2.length - 1];
                const value = parseFloat(latestCO2.cycle);
                const year = latestCO2.year;

                updateCardStatus(
                    cardId,
                    false,
                    `Latest: ${year} (global-warming.org)`,
                    value.toFixed(2),
                    'ppm'
                );

                // Update the chart
                createCO2Chart(labels, values);

            } catch (error) {
                console.error('Error fetching CO2 levels:', error);
                updateCardStatus(cardId, false, 'Failed to load data.', 'N/A', '');
                if (co2ChartInstance) co2ChartInstance.destroy(); // Clear chart on error
            }
        }

        // Function to fetch Solar Activity (X-ray Flux)
        async function fetchSolarActivity() {
            const cardId = 'solar';
            updateCardStatus(cardId, true, 'Fetching solar activity...');

            try {
                // Using NOAA SWPC for GOES X-ray flux data
                const response = await fetch('https://services.swpc.noaa.gov/json/goes/primary/xrays-6-hour.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                // Get the latest data point
                const latestFlux = data && data.length > 0 ? data[data.length - 1] : null;

                if (latestFlux && latestFlux.flux !== undefined && latestFlux.time_tag !== undefined) {
                    const fluxValue = latestFlux.flux;
                    const time = new Date(latestFlux.time_tag).toLocaleTimeString();

                    updateCardStatus(
                        cardId,
                        false,
                        `Last updated: ${time} (NOAA SWPC)`,
                        fluxValue.toExponential(1), // Display in scientific notation
                        'W/m²'
                    );
                } else {
                    updateCardStatus(cardId, false, 'No data available.', 'N/A', '');
                }
            } catch (error) {
                console.error('Error fetching solar activity:', error);
                updateCardStatus(cardId, false, 'Failed to load data.', 'N/A', '');
            }
        }

        // Function to display a static satellite fact
        function displaySatelliteFact() {
            const cardId = 'satellites';
            const fact = "Over 10,000 active satellites orbit Earth, providing GPS, communication, and scientific data!";
            updateCardStatus(
                cardId,
                false,
                'Source: Various Estimates',
                '~10,000+',
                'in Orbit'
            );
            // Update the main value to be the fact itself for a better display
            document.getElementById(`${cardId}-value`).textContent = fact;
            document.getElementById(`${cardId}-value`).classList.remove('text-5xl'); // Adjust font size for fact
            document.getElementById(`${cardId}-value`).classList.add('text-lg');
            document.getElementById(`${cardId}-unit`).textContent = ''; // Clear unit for fact
        }


        // Function to fetch Global UV Index
        async function fetchGlobalUvIndex() {
            const cardId = 'uv-index';
            updateCardStatus(cardId, true, 'Fetching UV Index...');

            // Using a fixed latitude/longitude for a representative global UV index
            // You could allow user input for this later if desired
            const latitude = 34.0522; // Example: Los Angeles
            const longitude = -118.2437; // Example: Los Angeles

            try {
                const response = await fetch(`https://currentuvindex.com/api/v1/uvi?latitude=${latitude}&longitude=${longitude}`);

                if (!response.ok) {
                    console.error(`UV Index API: HTTP error! Status: ${response.status}, Status Text: ${response.statusText}`);
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('UV Index API Response:', data); // Log the full response

                if (data && data.ok && data.now && data.now.uvi !== undefined) {
                    const uvi = data.now.uvi.toFixed(0); // UV Index is typically an integer
                    const time = new Date(data.now.time).toLocaleTimeString();

                    let uvDescription = '';
                    if (uvi <= 2) uvDescription = 'Low';
                    else if (uvi <= 5) uvDescription = 'Moderate';
                    else if (uvi <= 7) uvDescription = 'High';
                    else if (uvi <= 10) uvDescription = 'Very High';
                    else uvDescription = 'Extreme';


                    updateCardStatus(
                        cardId,
                        false,
                        `Current: ${time} (currentuvindex.com)`,
                        uvi,
                        uvDescription // Display description as unit
                    );
                } else {
                    console.warn('UV Index API: Data or UVI missing in response.', data);
                    updateCardStatus(cardId, false, 'No data available or malformed.', 'N/A', '');
                }
            } catch (error) {
                console.error('Error fetching UV Index:', error);
                updateCardStatus(cardId, false, `Failed to load data: ${error.message}.`, 'N/A', '');
            }
        }

        // Array of space facts for the rotating display
        const spaceFacts = [
            "A day on Venus is longer than its year.",
            "There are more stars in the universe than grains of sand on all Earth's beaches.",
            "The Sun's mass is 99.8% of the entire solar system's mass.",
            "One million Earths could fit inside the Sun.",
            "Neutron stars can spin 600 times per second.",
            "The largest known asteroid is Ceres, about 940 km wide.",
            "The highest mountain discovered is on Mars: Olympus Mons.",
            "Footprints on the Moon will stay there for 100 million years.",
            "The universe is estimated to be 13.8 billion old.",
            "Jupiter's Great Red Spot is a storm larger than Earth.",
            "It takes 8 minutes for light from the Sun to reach Earth.",
            "The coldest place in the universe is the Boomerang Nebula.",
            "There are more trees on Earth than stars in the Milky Way.",
            "The Milky Way galaxy is about 100,000 light-years across."
        ];
        let currentFactIndex = 0;
        let factIntervalId; // To store the interval ID for clearing

        // Function to rotate space facts (with optional direction)
        function rotateSpaceFacts(direction = 0) { // 0 for auto, 1 for next, -1 for previous
            const cardId = 'ozone';
            const ozoneValueElement = document.getElementById(`${cardId}-value`);
            const ozoneStatusElement = document.getElementById(`${cardId}-status`);

            // Clear existing interval to prevent conflicts with manual navigation
            clearInterval(factIntervalId);

            if (direction === 1) {
                currentFactIndex = (currentFactIndex + 1) % spaceFacts.length;
            } else if (direction === -1) {
                currentFactIndex = (currentFactIndex - 1 + spaceFacts.length) % spaceFacts.length;
            } else {
                // Auto rotation, just update the fact
                currentFactIndex = (currentFactIndex + 1) % spaceFacts.length;
            }

            // Ensure the value element is correctly sized for text
            ozoneValueElement.classList.remove('text-5xl');
            ozoneValueElement.classList.add('text-xl'); // Adjust font size for fact

            ozoneValueElement.textContent = spaceFacts[currentFactIndex];
            ozoneStatusElement.textContent = `Fact ${currentFactIndex + 1} of ${spaceFacts.length}`;

            // Restart the interval after manual interaction
            factIntervalId = setInterval(() => rotateSpaceFacts(0), 10000);
        }


        // Function to refresh all API data
        async function refreshAllData() {
            console.log('Refreshing all data...');
            // Disable the refresh button and show loading state
            const refreshButton = document.getElementById('refreshButton');
            if (refreshButton) { // Check if button exists before trying to manipulate it
                refreshButton.disabled = true;
                refreshButton.textContent = 'Refreshing...';
            }

            try {
                await fetchGlobalTemperature();
                await fetchCO2Levels();
                await fetchSolarActivity();
                displaySatelliteFact(); // This is static, but included for completeness
                await fetchGlobalUvIndex(); // Fetch Global UV Index
            } finally {
                // Re-enable the button and restore text after all fetches (success or failure)
                if (refreshButton) { // Check if button exists before trying to manipulate it
                    refreshButton.disabled = false;
                    refreshButton.textContent = 'Refresh All Data';
                }
                // Hide the loading overlay after initial data fetch is complete
                const loadingOverlay = document.getElementById('loading-overlay');
                const appContainer = document.getElementById('app-container');
                if (loadingOverlay && appContainer) {
                    loadingOverlay.classList.add('hidden');
                    appContainer.style.opacity = '1'; // Fade in the main content
                }
            }
        }

        // Event listeners
        window.addEventListener('resize', setCanvasSize);

        // Initialize and start animation and data fetching when the window loads
        window.onload = function() {
            setCanvasSize(); // Set initial size and initialize stars
            animate(); // Start the animation loop

            // Fetch initial data for all cards and then hide the loading overlay
            refreshAllData();

            // Set interval to refresh data every 5 minutes (300,000 milliseconds)
            setInterval(refreshAllData, 300000);

            // Start rotating space facts (already on its own interval)
            rotateSpaceFacts(); // Display first fact immediately
            // The interval is now managed within rotateSpaceFacts itself
            // setInterval(rotateSpaceFacts, 10000); // Removed from here

            // Add event listener for the manual refresh button
            const refreshButton = document.getElementById('refreshButton');
            if (refreshButton) { // Ensure the button exists before adding listener
                refreshButton.addEventListener('click', refreshAllData);
            }

            // Add click listeners to data cards to toggle chart visibility
            const dataCards = document.querySelectorAll('#data-cards-container > div');
            dataCards.forEach(card => {
                card.addEventListener('click', function() {
                    const chartContainer = this.querySelector('.chart-container');
                    if (chartContainer) {
                        chartContainer.classList.toggle('chart-visible');
                    }
                });
            });

            // Add event listeners for Space Fact navigation buttons
            const prevFactBtn = document.getElementById('prevFactBtn');
            const nextFactBtn = document.getElementById('nextFactBtn');

            if (prevFactBtn) {
                prevFactBtn.addEventListener('click', () => rotateSpaceFacts(-1));
            }
            if (nextFactBtn) {
                nextFactBtn.addEventListener('click', () => rotateSpaceFacts(1));
            }
        };
    </script>
</body>
</html>
